version: 2

models:
  - name: int_order_line_items
    description: >
      "Contains one row per order line item across all sales channels.
      Includes all orders including unfulfilled and cancelled."
    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns:
              - order_source
              - order_id
              - purchase_id
    columns:
      - name: order_id
        tests:
          - not_null
      - name: order_source
        tests:
          - accepted_values:
              arguments:
                values: ['shopee', 'direct']
      - name: ordered_timestamp
        tests:
          - not_null
      - name: paid_date
        description: >
          Date when payment for the order was received. For direct orders, this is
          manually inputted. For Shopee orders, it is derived using ordered_timestamp as proxy
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "is not null"
                where: "order_source = 'shopee'"
      - name: customer_name
        tests:
          - not_null
      - name: purchase_id
        tests:
          - not_null
      - name: purchase_type
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['sku', 'freebie']
      - name: quantity
        tests:
          - not_null
      - name: net_revenue
        tests:
          - not_null
      - name: cancel_date