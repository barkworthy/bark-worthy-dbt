version: 2

models:
  - name: dim_customers
    description: >
      Dimension table containing one row per unique customer within each order_source.
      Customers are identified by a deterministic surrogate key generated from
      order_source and customer_name. Metrics reflect completed (non-cancelled)
      orders only.

    columns:
      - name: customer_id
        description: >
          Deterministic surrogate key uniquely identifying a customer within an
          order_source. Generated from order_source and customer_name and used as
          the primary key for this table.
        tests:
          - not_null

      - name: order_source
        description: >
          Sales channel where the customer placed orders (e.g., Shopee, Instagram).
          Forms part of the natural customer identifier since identities are not
          unified across sources.

      - name: customer_name
        description: >
          Customer identifier captured from the order source (e.g., Shopee username
          or Instagram handle). Uniqueness is only guaranteed within each
          order_source.

      - name: first_order_timestamp
        description: >
          Timestamp of the customer’s first completed order within the given
          order_source. Cancelled orders are excluded.

      - name: last_order_timestamp
        description: >
          Timestamp of the customer’s most recent completed order within the given
          order_source. Cancelled orders are excluded.

      - name: lifetime_num_orders
        description: >
          Total number of completed orders placed by the customer within the given
          order_source. Cancelled orders are excluded.

      - name: lifetime_revenue
        description: >
          Total net revenue generated by the customer across all completed orders
          within the given order_source. Derived from summed order-level net revenue
          and excludes cancelled orders.