version: 2

models:

  - name: fact_orders_line_items
    description: >
      "Contains one row per order line item across all sales channels.
      Includes all orders including unfulfilled and cancelled."
    columns:
      - name: order_id
      - name: order_source
      - name: order_timestamp
      - name: payment_date
      - name: customer_name
      - name: purchase_id
      - name: purchase_type
      - name: quantity
      - name: net_revenue
      - name: cancel_date
  - name: fact_orders
    description: ""
    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns:
              - order_source
              - order_id
    columns:
      - name: order_id
        description: Unique identifier of the order.
      - name: order_source
        description: Source platform where the order was placed (e.g. Shopee, direct).
      - name: order_timestamp
        description: Timestamp the order was created on the source platform.
      - name: payment_date
        description: .
          Date when payment for the order was received. For direct orders, this is
          manually inputted. For Shopee orders, it is derived using order_timestamp as proxy
      - name: customer_name
        description: Customer name associated with the order.
      - name: cancel_date
        description: Date the order was cancelled, if applicable. Null for completed orders.
      - name: purchased_quantity
        description: Total number of SKU units purchased in the order, excluding freebies.
      - name: num_purchase_types
        description: Number of distinct SKU product types purchased in the order.
      - name: total_net_revenue
        description: Total net revenue from SKU items in the order, excluding freebies and non-revenue items.
      - name: freebies_quantity
        description: Total number of freebie units included in the order.
      - name: num_freebie_types
        description: Number of distinct freebie product types included in the order.
      - name: is_new_order
        descrption: >
          Boolean. Indicates whether the order is the customer's first order.
          Derived using customer_name and customer_source. Only applies to orders where
          is_valid_order = true. Null for invalid orders.
      - name: is_valid_order
        description: >
          Boolean. Indicates whether order went through. Requires payment_date to not be null
          and for cancel_date to be null.
        tests:
          - not_null